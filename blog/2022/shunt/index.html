<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="robots" content="all"> <meta name="google-site-verification" content="8wzYblVUAwjDGn2yb7nky80HsnYb5vQ0aeaolOCv3Is"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>A simple motor shunt regulator | Christopher Mailer</title> <meta name="author" content="Christopher Mailer"> <meta name="description" content="An automatic shunt regulator for dissipating motor regen power"> <meta name="keywords" content="chrismailer, christopher, mailer, africa, profile, portfolio, engineering, design, research, robotics, mechatronics"> <meta property="og:site_name" content="A simple motor shunt regulator | Christopher Mailer"> <meta property="og:type" content="website"> <meta property="og:title" content="A simple motor shunt regulator | Christopher Mailer"> <meta property="og:url" content="https://chrismailer.github.io/blog/2022/shunt/"> <meta property="og:description" content="An automatic shunt regulator for dissipating motor regen power"> <meta property="og:image" content="/assets/img/profile.jpeg"> <meta property="og:locale" content="en"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="A simple motor shunt regulator"> <meta name="twitter:description" content="An automatic shunt regulator for dissipating motor regen power"> <meta name="twitter:image" content="/assets/img/profile.jpeg"> <script type="application/ld+json">
      {
        "author":
        {
          "@type": "Person",
          "name": "Christopher  Mailer"
        },
        "url": "https://chrismailer.github.io/blog/2022/shunt/",
        "@type": "WebSite",
        "description": "An automatic shunt regulator for dissipating motor regen power",
        "headline": "A simple motor shunt regulator",
        "sameAs": ["https://scholar.google.com/citations?user=lDH4KnUAAAAJ", "https://github.com/chrismailer", "https://www.linkedin.com/in/chrismailer"],
        "name": "Christopher  Mailer",
        "@context": "https://schema.org"
      }
    </script> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="icon" type="image/png" href="/assets/favicon/favicon-228.png" sizes="228x228"> <link rel="icon" type="image/png" href="/assets/favicon/favicon-128.png" sizes="128x128"> <link rel="icon" type="image/png" href="/assets/favicon/favicon-96.png" sizes="96x96"> <link rel="icon" type="image/png" href="/assets/favicon/favicon-76.png" sizes="76x76"> <link rel="icon" type="image/png" href="/assets/favicon/favicon-57.png" sizes="57x57"> <link rel="icon" type="image/png" href="/assets/favicon/favicon-32.png" sizes="32x32"> <link rel="icon" type="image/png" href="/assets/favicon/favicon-16.png" sizes="16x16"> <link rel="apple-touch-icon" href="/assets/favicon/favicon-180.png" sizes="180x180"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://chrismailer.github.io/blog/2022/shunt/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Christopher </span>Mailer</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">projects<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">A simple motor shunt regulator</h1> <p class="post-meta">August 16, 2022</p> <p class="post-tags"> <a href="/blog/2022"> <i class="fas fa-calendar fa-sm"></i> 2022 </a>   ·   <a href="/blog/category/electronics"> <i class="fas fa-tag fa-sm"></i> Electronics</a>   <a href="/blog/category/control"> <i class="fas fa-tag fa-sm"></i> Control</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Two of the legged robots I have worked on use low Kv BLDC motors coupled to a planetary gearbox as their actuators like the Mini Cheetah actuators. These actuators are great, but have a small problem when running from the lab power supply rather than a battery pack. When doing negative work the motors will back-feed the power supply, raising the voltage on the output filtering capacitors and triggering the over voltage protection. This has resulted in many of the robots shutting down and collapsing in a rather dramatic fashion.</p> <p>To solve this I built an automatic shunt regulator based off of the one I saw on the open-source <a href="https://odriverobotics.com/" rel="external nofollow noopener" target="_blank">ODrive</a> motor controller. I tried to buy a hobby one online but the <a href="https://www.pololu.com/category/249/shunt-regulators" rel="external nofollow noopener" target="_blank">biggest I could find</a> was rate for an anemic 15W and only went up to 33V, not the 48V we needed. Plus I thought it would be interesting to try and make one.</p> <p>The shunt regulator works by monitoring the bus voltage and dumping the energy from the motors into a 50W 0.47Ω power resistor, essentially acting as a variable load to regulate the voltage. A microcontroller monitors the bus voltage with a voltage divider and modulates the amount of power going into the brake resistor by varying the duty cycle of a 20kHz PWM signal switching a MOSFET. The gate driver quickly charges the gate capacitance and ensures the MOSFET is turned on hard, minimizing power dissipation during conduction.</p> <div class="row"> <div class="col-sm-2 mt-3 mt-md-0"></div> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/shunt/schematic-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/shunt/schematic-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/shunt/schematic-1400.webp"></source> <img src="/assets/img/shunt/schematic.png" class="img-fluid rounded" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm-2 mt-3 mt-md-0"></div> </div> <div class="caption"> Simplified schematic of the shunt regulator circuit. It isn't shown here, but I also included a large flyback diode in parallel with the power resistor. </div> <p>The reason for the PWM signal is to be able to modulate the amount of power dissipation rather than dumping the maximum possible power of over 1.2kW for only a small rise in voltage. The PWM signal is controlled with this simple proportional controller where current to the brake resistor is increased proportionally based on the bus voltage providing a smooth fade in or out of power dissipation. Here’s the C code snippet running on the micro.</p> <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">brake_duty</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">((</span><span class="n">v_bus</span> <span class="o">-</span> <span class="n">v_ramp_start</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">v_ramp_end</span> <span class="o">-</span> <span class="n">v_ramp_start</span><span class="p">),</span> <span class="mf">0.0</span><span class="n">f</span><span class="p">),</span> <span class="mf">1.0</span><span class="n">f</span><span class="p">);</span>
</code></pre></div></div> <p>By configuring <code class="language-plaintext highlighter-rouge">v_ramp_start</code> and <code class="language-plaintext highlighter-rouge">v_ramp_end</code> in the firmware the supply voltage and responsiveness to voltage spikes can be adjusted.</p> <div class="row"> <div class="col-sm-3 mt-3 mt-md-0"></div> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/shunt/cover-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/shunt/cover-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/shunt/cover-1400.webp"></source> <img src="/assets/img/shunt/cover.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm-3 mt-3 mt-md-0"></div> </div> <div class="caption"> Working circuit on prototype board. </div> <p>You can’t see it in this image of the board, but I also soldered a thick single core copper wire to the main power rails underneath just because pushing 40A through proto board tracks didn’t seem like a great idea. I never got around to designing a PCB for this and making the circuit more robust, but that could be a fun future project.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/surf/">Surf Webcams</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/kemba/">Kemba: A hybrid legged robot</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/hopper/">A hopping robot</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/velocity-estimator/">Estimating encoder velocity</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/boom/">Planarising boom for legged robots</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Christopher Mailer. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js"></script> <script defer src="/assets/js/common.js"></script> <script defer src="/assets/js/copy_code.js" type="text/javascript"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-7CBDKZFSBL"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-7CBDKZFSBL");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>